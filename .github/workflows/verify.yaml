name: "verify"

on:
  push:
    tags:
      - '*'

jobs:

  build:
    name: "project compilation and testing"
    runs-on: "ubuntu-latest"
    steps:

      - name: "checkout project"
        uses: "actions/checkout@v4"
        with:
          ref: "${{ github.ref_name }}"

      - name: "setup Java 21"
        uses: "actions/setup-java@v4"
        with:
          distribution: "temurin"
          java-version: "21"

      - name: "maven - verify"
        run: "mvn verify --no-transfer-progress --errors"

      - name: "generate JaCoCo badge"
        uses: "cicirello/jacoco-badge-generator@v2"

      - name: "commit JaCoCo badge"
        run: |
          if [[ `git status --porcelain` ]]; then
            git config --global user.name 'Jonathan Gu√©henneux'
            git config --global user.email 'achaaab@users.noreply.github.com'
            git add --all
            git commit --message "autogenerated JaCoCo coverage badge"
            git push
          fi
